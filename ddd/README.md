# DDDç¤ºä¾‹é¡¹ç›® - Goè¯­è¨€å®ç°

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨Goè¯­è¨€å®ç°çš„é¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)åŸºç¡€ç¤ºä¾‹é¡¹ç›®ï¼Œä¸“ä¸ºç†Ÿæ‚‰è´«è¡€æ¨¡å¼çš„å¼€å‘è€…è®¾è®¡ï¼Œé€šè¿‡å…·ä½“å®ç°å±•ç¤ºDDDçš„æ ¸å¿ƒæ¦‚å¿µå’Œå®è·µæ–¹æ³•ã€‚

## ğŸ¯ é¡¹ç›®ç›®æ ‡

- **å±•ç¤ºDDDæ ¸å¿ƒæ¦‚å¿µ**: å®ä½“(Entity)ã€å€¼å¯¹è±¡(Value Object)ã€é¢†åŸŸæœåŠ¡(Domain Service)ã€é¢†åŸŸäº‹ä»¶(Domain Event)
- **å¯¹æ¯”è´«è¡€æ¨¡å¼ä¸DDD**: å¸®åŠ©å¼€å‘è€…ç†è§£ä»è´«è¡€æ¨¡å¼åˆ°DDDæ¶æ„çš„è½¬å˜
- **æä¾›å®Œæ•´ç¤ºä¾‹**: åŒ…å«ç”¨æˆ·ç®¡ç†å’Œè®¢å•ç®¡ç†çš„å®Œæ•´ä¸šåŠ¡æµç¨‹
- **å¯è¿è¡Œä»£ç **: æ‰€æœ‰ä»£ç éƒ½å¯ä»¥ç›´æ¥è¿è¡Œå’Œæµ‹è¯•

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

é¡¹ç›®ä¸¥æ ¼éµå¾ªDDDåˆ†å±‚æ¶æ„ï¼š

```
ddd/
â”œâ”€â”€ api/                    # æ¥å£å±‚ (Interface Layer)
â”‚   â”œâ”€â”€ user_controller.go     # ç”¨æˆ·æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ order_controller.go    # è®¢å•æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ health_controller.go   # å¥åº·æ£€æŸ¥æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ router.go             # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ middleware.go         # ä¸­é—´ä»¶
â”‚   â””â”€â”€ response.go           # å“åº”å¤„ç†
â”œâ”€â”€ domain/                 # é¢†åŸŸå±‚ (Domain Layer)
â”‚   â”œâ”€â”€ user.go               # ç”¨æˆ·å®ä½“
â”‚   â”œâ”€â”€ order.go              # è®¢å•å®ä½“
â”‚   â”œâ”€â”€ value_objects.go      # å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ services.go           # é¢†åŸŸæœåŠ¡
â”‚   â”œâ”€â”€ events.go             # é¢†åŸŸäº‹ä»¶
â”‚   â””â”€â”€ repositories.go       # ä»“å‚¨æ¥å£
â”œâ”€â”€ repository/             # ä»“å‚¨å±‚æ¥å£å®šä¹‰
â”‚   â””â”€â”€ interfaces.go         # ä»“å‚¨æ¥å£
â”œâ”€â”€ mock/                   # ä»“å‚¨å±‚Mockå®ç°
â”‚   â”œâ”€â”€ user_repository.go    # ç”¨æˆ·ä»“å‚¨Mock
â”‚   â”œâ”€â”€ order_repository.go   # è®¢å•ä»“å‚¨Mock
â”‚   â””â”€â”€ event_publisher.go    # äº‹ä»¶å‘å¸ƒå™¨Mock
â”œâ”€â”€ service/                # åº”ç”¨å±‚æœåŠ¡ (Application Layer)
â”‚   â”œâ”€â”€ user_service.go       # ç”¨æˆ·åº”ç”¨æœåŠ¡
â”‚   â””â”€â”€ order_service.go      # è®¢å•åº”ç”¨æœåŠ¡
â”œâ”€â”€ model/                  # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ models.go             # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ util/                   # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ utils.go              # é€šç”¨å·¥å…·ç±»
â”œâ”€â”€ cmd/                    # å‘½ä»¤è¡Œå…¥å£
â”‚   â””â”€â”€ app.go                # åº”ç”¨ç¨‹åºå…¥å£
â”œâ”€â”€ main.go                 # ä¸»å‡½æ•°
â””â”€â”€ go.mod                  # Goæ¨¡å—å®šä¹‰
```

## ğŸ§© DDDæ ¸å¿ƒæ¦‚å¿µå®ç°

### 1. å®ä½“ (Entity)

**ç”¨æˆ·å®ä½“** (`domain/user.go`):
```go
type User struct {
    id        string
    name      string
    email     Email
    age       int
    isActive  bool
    createdAt time.Time
    updatedAt time.Time
}
```

ç‰¹ç‚¹ï¼š
- å…·æœ‰å”¯ä¸€æ ‡è¯†(ID)
- åŒ…å«ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€
- é€šè¿‡æ–¹æ³•æš´éœ²è¡Œä¸ºï¼Œè€Œä¸æ˜¯ç›´æ¥æš´éœ²çŠ¶æ€

### 2. å€¼å¯¹è±¡ (Value Object)

**Emailå€¼å¯¹è±¡** (`domain/value_objects.go`):
```go
type Email struct {
    value string
}
```

**Moneyå€¼å¯¹è±¡** (`domain/value_objects.go`):
```go
type Money struct {
    amount   int64
    currency string
}
```

ç‰¹ç‚¹ï¼š
- ä¸å¯å˜(immutable)
- æ²¡æœ‰å”¯ä¸€æ ‡è¯†
- é€šè¿‡å€¼ç›¸ç­‰æ€§è¿›è¡Œæ¯”è¾ƒ
- å°è£…ä¸šåŠ¡è§„åˆ™ï¼ˆå¦‚é‚®ç®±æ ¼å¼éªŒè¯ï¼‰

### 3. é¢†åŸŸæœåŠ¡ (Domain Service)

**ç”¨æˆ·é¢†åŸŸæœåŠ¡** (`domain/services.go`):
```go
type UserDomainService struct {
    userRepository  UserRepository
    orderRepository OrderRepository
}
```

ç‰¹ç‚¹ï¼š
- å¤„ç†è·¨å®ä½“çš„ä¸šåŠ¡é€»è¾‘
- åè°ƒå¤šä¸ªå®ä½“å®Œæˆå¤æ‚ä¸šåŠ¡æ“ä½œ
- ä¸åŒ…å«çŠ¶æ€ï¼ŒåªåŒ…å«è¡Œä¸º

### 4. é¢†åŸŸäº‹ä»¶ (Domain Event)

**ç”¨æˆ·åˆ›å»ºäº‹ä»¶** (`domain/events.go`):
```go
type UserCreatedEvent struct {
    userID     string
    name       string
    email      string
    occurredOn time.Time
}
```

ç‰¹ç‚¹ï¼š
- è¡¨ç¤ºé¢†åŸŸä¸­å‘ç”Ÿçš„é‡è¦äº‹ä»¶
- ç”¨äºè§£è€¦ä¸åŒæ¨¡å—
- æ”¯æŒäº‹ä»¶é©±åŠ¨æ¶æ„

### 5. ä»“å‚¨ (Repository)

ä»“å‚¨æ¥å£å®šä¹‰åœ¨ `domain/repositories.go` ä¸­ï¼ŒMockå®ç°åœ¨ `mock/` ç›®å½•ä¸‹ã€‚

ç‰¹ç‚¹ï¼š
- æä¾›é¢†åŸŸå¯¹è±¡çš„æŒä¹…åŒ–æœºåˆ¶
- å±è”½åº•å±‚æ•°æ®å­˜å‚¨ç»†èŠ‚
- æä¾›é¢†åŸŸè¯­ä¹‰çš„æ•°æ®è®¿é—®æ¥å£

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.21 æˆ–æ›´é«˜ç‰ˆæœ¬
- Git

### å®‰è£…ä¾èµ–

```bash
cd /home/shize/note/ddd
go mod download
```

### è¿è¡Œé¡¹ç›®

```bash
go run main.go
```

æˆ–ä½¿ç”¨æŒ‡å®šç«¯å£ï¼š

```bash
go run main.go -port 8080
```

### æµ‹è¯•API

é¡¹ç›®å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æµ‹è¯•APIï¼š

#### 1. å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8080/api/v1/health
```

#### 2. åˆ›å»ºç”¨æˆ·
```bash
curl -X POST http://localhost:8080/api/v1/users \
  -H "Content-Type: application/json" \
  -d '{
    "name": "å¼ ä¸‰",
    "email": "zhangsan@example.com",
    "age": 25
  }'
```

#### 3. è·å–ç”¨æˆ·åˆ—è¡¨
```bash
curl http://localhost:8080/api/v1/users
```

#### 4. è·å–æŒ‡å®šç”¨æˆ·
```bash
curl http://localhost:8080/api/v1/users/user-1
```

#### 5. åˆ›å»ºè®¢å•
```bash
curl -X POST http://localhost:8080/api/v1/orders \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user-1",
    "items": [
      {
        "product_id": "prod-1",
        "product_name": "iPhone 15",
        "quantity": 1,
        "unit_price": 699900,
        "currency": "CNY"
      }
    ]
  }'
```

#### 6. è·å–ç”¨æˆ·è®¢å•
```bash
curl http://localhost:8080/api/v1/orders/user/user-1
```

## ğŸ“– æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### ç”¨æˆ·åˆ›å»ºæµç¨‹

1. **APIå±‚**æ¥æ”¶åˆ›å»ºç”¨æˆ·è¯·æ±‚
2. **åº”ç”¨æœåŠ¡**éªŒè¯é‚®ç®±å”¯ä¸€æ€§
3. **é¢†åŸŸå±‚**åˆ›å»ºç”¨æˆ·å®ä½“ï¼ˆåŒ…å«ä¸šåŠ¡è§„åˆ™éªŒè¯ï¼‰
4. **ä»“å‚¨å±‚**ä¿å­˜ç”¨æˆ·æ•°æ®
5. **é¢†åŸŸäº‹ä»¶**å‘å¸ƒç”¨æˆ·åˆ›å»ºäº‹ä»¶
6. **APIå±‚**è¿”å›åˆ›å»ºç»“æœ

### è®¢å•åˆ›å»ºæµç¨‹

1. **APIå±‚**æ¥æ”¶åˆ›å»ºè®¢å•è¯·æ±‚
2. **åº”ç”¨æœåŠ¡**æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥ä¸‹å•ï¼ˆé€šè¿‡é¢†åŸŸæœåŠ¡ï¼‰
3. **é¢†åŸŸæœåŠ¡**éªŒè¯ç”¨æˆ·çŠ¶æ€ã€å¹´é¾„ã€å¾…å¤„ç†è®¢å•æ•°é‡ç­‰
4. **é¢†åŸŸå±‚**åˆ›å»ºè®¢å•å®ä½“
5. **ä»“å‚¨å±‚**ä¿å­˜è®¢å•æ•°æ®
6. **é¢†åŸŸäº‹ä»¶**å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶
7. **APIå±‚**è¿”å›åˆ›å»ºç»“æœ

## ğŸ” ä»è´«è¡€æ¨¡å¼åˆ°DDDçš„è½¬å˜

### è´«è¡€æ¨¡å¼çš„é—®é¢˜

åœ¨è´«è¡€æ¨¡å¼ä¸­ï¼Œé€šå¸¸ä¼šæœ‰ï¼š
- **è´«è¡€å®ä½“**: åªåŒ…å«æ•°æ®ï¼Œæ²¡æœ‰ä¸šåŠ¡é€»è¾‘
- **äº‹åŠ¡è„šæœ¬**: æ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½åœ¨æœåŠ¡å±‚
- **ä½å†…èš**: ä¸šåŠ¡é€»è¾‘åˆ†æ•£åœ¨å„ä¸ªæœåŠ¡ä¸­

```go
// è´«è¡€æ¨¡å¼ç¤ºä¾‹ï¼ˆä¸æ¨èï¼‰
type User struct {
    ID    string `json:"id"`
    Name  string `json:"name"`
    Email string `json:"email"`
    Age   int    `json:"age"`
    // æ²¡æœ‰ä¸šåŠ¡é€»è¾‘æ–¹æ³•
}

// ä¸šåŠ¡é€»è¾‘åœ¨æœåŠ¡å±‚
func (s *UserService) CreateUser(name, email string, age int) error {
    if name == "" {
        return errors.New("name cannot be empty")
    }
    if age < 0 || age > 150 {
        return errors.New("invalid age")
    }
    // ... æ›´å¤šéªŒè¯é€»è¾‘
}
```

### DDDçš„ä¼˜åŠ¿

åœ¨DDDä¸­ï¼š
- **å¯Œé¢†åŸŸæ¨¡å‹**: å®ä½“åŒ…å«ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€
- **é«˜å†…èš**: ç›¸å…³é€»è¾‘å°è£…åœ¨å®ä½“å†…éƒ¨
- **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**: ä¸šåŠ¡é€»è¾‘é›†ä¸­åœ¨é¢†åŸŸå±‚

```go
// DDDæ¨¡å¼ï¼ˆæ¨èï¼‰
type User struct {
    id    string
    name  string
    email Email
    age   int
    // çŠ¶æ€ç§æœ‰åŒ–
}

// ä¸šåŠ¡é€»è¾‘åœ¨å®ä½“å†…éƒ¨
func NewUser(name string, email string, age int) (*User, error) {
    if name == "" {
        return nil, ErrInvalidName
    }
    if age < 0 || age > 150 {
        return nil, ErrInvalidAge
    }
    // ... åˆ›å»ºé€»è¾‘
}

// é€šè¿‡æ–¹æ³•æš´éœ²è¡Œä¸º
func (u *User) CanMakePurchase() bool {
    return u.isActive && u.age >= 18
}
```

## ğŸ§ª æµ‹è¯•æ•°æ®

é¡¹ç›®å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼š

### æµ‹è¯•ç”¨æˆ·
- **user-1**: å¼ ä¸‰ (zhangsan@example.com, 25å²)
- **user-2**: æå›› (lisi@example.com, 30å²)  
- **user-3**: ç‹äº” (wangwu@example.com, 35å²)

### æµ‹è¯•è®¢å•
- **order-1**: user-1çš„è®¢å•ï¼ŒåŒ…å«iPhone 15å’ŒMacBook Proï¼ˆå·²å‘è´§ï¼‰
- **order-2**: user-2çš„è®¢å•ï¼ŒåŒ…å«2ä¸ªAirPods Proï¼ˆå·²ç¡®è®¤ï¼‰
- **order-3**: user-1çš„è®¢å•ï¼ŒåŒ…å«iPhone 15ï¼ˆå¾…å¤„ç†ï¼‰

## ğŸ”§ æ‰©å±•å»ºè®®

### 1. æ·»åŠ çœŸå®æ•°æ®åº“
- å®ç°çœŸå®çš„ä»“å‚¨å±‚ï¼Œè¿æ¥MySQLã€PostgreSQLç­‰æ•°æ®åº“
- æ·»åŠ æ•°æ®åº“è¿ç§»è„šæœ¬
- å®ç°äº‹åŠ¡ç®¡ç†

### 2. å¢å¼ºé¢†åŸŸäº‹ä»¶
- å®ç°äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰
- æ·»åŠ äº‹ä»¶å­˜å‚¨ï¼ˆEvent Storeï¼‰
- å®ç°äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰

### 3. æ·»åŠ CQRSæ¨¡å¼
- åˆ†ç¦»å‘½ä»¤å’ŒæŸ¥è¯¢èŒè´£
- å®ç°è¯»å†™åˆ†ç¦»
- æ·»åŠ ä¸“é—¨çš„æŸ¥è¯¢æ¨¡å‹

### 4. æ·»åŠ æ›´å¤šé™ç•Œä¸Šä¸‹æ–‡
- å•†å“ç®¡ç†ä¸Šä¸‹æ–‡
- åº“å­˜ç®¡ç†ä¸Šä¸‹æ–‡
- æ”¯ä»˜ç®¡ç†ä¸Šä¸‹æ–‡

## ğŸ“š å­¦ä¹ èµ„æº

### DDDæ ¸å¿ƒæ¦‚å¿µ
- ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹- Eric Evans
- ã€Šå®ç°é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹- Vaughn Vernon
- ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡æ¨¡å¼ã€åŸç†ä¸å®è·µã€‹- Scott Millett

### Goè¯­è¨€èµ„æº
- [Goå®˜æ–¹æ–‡æ¡£](https://golang.org/doc/)
- [Effective Go](https://golang.org/doc/effective_go.html)
- [Go by Example](https://gobyexample.com/)

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚åœ¨è´¡çŒ®ä¹‹å‰ï¼Œè¯·ï¼š

1. é˜…è¯»é¡¹ç›®æ–‡æ¡£å’Œä»£ç 
2. åœ¨Issueä¸­æè¿°ä½ çš„æ”¹è¿›å»ºè®®
3. éµå¾ªGoè¯­è¨€çš„ç¼–ç è§„èŒƒ
4. æ·»åŠ é€‚å½“çš„æµ‹è¯•ç”¨ä¾‹

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ†˜ æ”¯æŒ

å¦‚æœä½ åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£
2. åœ¨Issueä¸­å¯»æ±‚å¸®åŠ©
3. è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

**Happy Coding! ğŸ‰**