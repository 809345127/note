# DDD 项目改进记录与实施计划

本文档记录本项目从“演示代码”向“生产基线”演进的关键改进。

## 已完成改进

### 1. Outbox 落地（可选启用）

- 新增 outbox 持久化对象与仓储实现。
- UoW 在同事务内保存业务数据与领域事件。
- 通过配置开关控制是否启用，默认关闭。

### 2. 并发重试机制

- 引入可配置重试组件（指数退避 + 抖动）。
- 对并发冲突、死锁、锁等待超时等场景可按配置重试。
- 重试粒度在 UoW 层，确保单次重试使用全新事务。

### 3. 规格模式（Specification）

- 增加通用 `Specification[T]` 与组合规格（AND/OR/NOT）。
- 仓储按规格构建查询，降低方法爆炸。
- 保持领域层纯净，不引入 ORM 依赖。

### 4. 结构契约校验

- 启动时校验关键表和索引是否存在。
- 明确“DDL 外部托管，应用只校验不创建”。

### 5. UoW 工厂化

- 避免跨请求复用同一个可变 UoW。
- 每个用例调用创建独立 UoW，降低并发风险。

## 后续可选改进

1. 引入读模型与 CQRS（按业务复杂度决定）。
2. 增加命令幂等机制（防止重复提交）。
3. 建立事件版本治理（支持事件 schema 演进）。
4. 补充更多领域不变量测试模板。

## 结论

当前代码已可作为公司内部 Go + DDD + Gin + GORM 的评审基线。建议结合 `docs/review/checklist.md` 执行日常评审，以持续约束分层与工程质量。
