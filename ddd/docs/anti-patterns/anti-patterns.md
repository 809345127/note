# 反模式与修复建议

## 1. 跨请求共享可变 UnitOfWork

- 错误做法：单例 UoW 保存所有请求中的聚合状态。
- 风险：事件串扰、并发竞争。
- 修复：使用 `UnitOfWorkFactory`，每次用例调用创建全新 UoW。

## 2. 业务逻辑写在 Gin 控制器

- 错误做法：Handler 直接决定领域状态流转和规则。
- 风险：规则重复、难测试、不变量不一致。
- 修复：控制器保持薄层，规则下沉到领域/应用服务。

## 3. 把 AutoMigrate 当作生产建表策略

- 错误做法：运行时隐式修改生产库结构。
- 风险：结构漂移不可控，容易引发线上事故。
- 修复：外部 DDL 托管 + 启动时契约校验。

## 4. 应用层直接访问数据库

- 错误做法：Service 直接调用 GORM。
- 风险：绕过聚合边界、事务不一致。
- 修复：统一通过仓储 + UoW 管理事务边界。
